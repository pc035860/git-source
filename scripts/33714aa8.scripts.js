"use strict";angular.module("gitSourceApp",["ngSelect","hljs","ui.router"]).constant("gsConst",{THEME_MAP:{arta:"dark",ascetic:"light",brown_paper:"dark","default":"light",docco:"light",far:"dark",foundation:"light",github:"light",googlecode:"light",idea:"light",ir_black:"dark",magula:"light","mono-blue":"light",monokai:"dark",monokai_sublime:"dark",obsidian:"dark",pojoaque:"dark",railscasts:"dark",rainbow:"dark",school_book:"dark",solarized_dark:"dark",solarized_light:"light",sunburst:"dark","tomorrow-night-blue":"dark","tomorrow-night-bright":"dark","tomorrow-night-eighties":"dark","tomorrow-night":"dark",tomorrow:"light",vs:"light",xcode:"light",zenburn:"dark"}}).config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise(".example"),a.state("main",{url:"/*sourcePath?theme&fontsize&file&line&lang&result&autogrow"})}]),angular.module("gitSourceApp").controller("MainCtrl",["$scope","$stateParams","$state","gsConst","$log",function(a,b,c,d){var e=function(){var a={};return function(b){return angular.equals(b,a)}}();a.$stateParams=b,a.$watch("$stateParams",function(c){if(!e(c)){a.sourcePath=b.sourcePath;var f=angular.copy(c);delete f.sourcePath,a.options=f,a.containerTheme="light",a.highlightTheme="default",a.options.theme in d.THEME_MAP&&(a.highlightTheme=a.options.theme,a.containerTheme=d.THEME_MAP[a.options.theme])}},!0)}]),angular.module("gitSourceApp").factory("$interval",["$timeout",function(a){return function(b,c){var d,e=0,f=!1,g=function(){d=a(function(){angular.isFunction(b)&&b(e++),f||g()},c)};return g(),function(){return f=!0,a.cancel(d)}}}]),angular.module("gitSourceApp").factory("gitSourceData",["$http","$q","$log",function(a,b){var c="git-source.json";return function(d){var e;return a.get(d+c).then(function(c){e=c.data;var f=[];return angular.forEach(e.files,function(b){f.push(a.get(d+b))}),b.all(f)}).then(function(a){var b=e.files;return e.files={},angular.forEach(b,function(b,c){e.files[b]={filename:b,content:a[c].data}}),e}).then(null,function(){return null})}}]),angular.module("gitSourceApp").factory("formPostData",["$document",function(a){return function(b,c){var d=angular.element('<form style="display: none;" method="post" action="'+b+'" target="_blank"></form>');angular.forEach(c,function(a){var b=a.name,c=a.value,e=angular.element('<input type="hidden" name="'+b+'">');e.attr("value",c),d.append(e)}),a.find("body").append(d),d[0].submit(),d.remove()}}]),angular.module("gitSourceApp").factory("openPlunker",["formPostData",function(a){return function(b,c,d){var e=[];c=c||"",d=d||[],angular.forEach(b,function(a){e.push({name:"files["+a.filename+"]",value:a.content})}),angular.forEach(d,function(a){e.push({name:"tags[]",value:a})}),e.push({name:"private",value:!0}),e.push({name:"description",value:c}),a("http://plnkr.co/edit/?p=preview",e)}}]),angular.module("gitSourceApp").factory("sendAutogrowMsg",["$window","$location","$document","$log","$interval",function(a,b,c,d,e){var f,g=100,h=10;return function(b){(f||angular.noop)();var d=0,i=-1,j=function(){var e=c.find("iframe")[0],g=c.find("code")[0],j=g||e,k={id:b,height:j.scrollHeight+(j.offsetTop||j.parentElement.offsetTop)};if(0!==k.height){if(k.height===i){if(d++,d>=h)return f(),void 0}else k.height>i&&(d=0,i=k.height);a.parent.postMessage(JSON.stringify(k),"*")}};f=e(j,g),j()}}]),angular.module("gitSourceApp").directive("gitSource",["gitSourceData","openPlunker","$q","$log","sendAutogrowMsg","$timeout",function(a,b,c,d,e,f){return{restrict:"EA",scope:{sourcePath:"@gitSource",config:"=gitSourceOptions"},templateUrl:"git-source-template.html",link:function(c,d){function g(a){if(a&&(a.fontsize&&d.find("pre").css("font-size",a.fontsize+"px"),c.model.specifiedFileContent=null,a.file&&a.file in c.fileIndex&&(c.model.specifiedFileContent=c.fileIndex[a.file].content,a.line))){var b,e,f=a.line.split("-");f.length<2?b=e=Math.max(1,parseInt(f[0],10)):(b=f[0],e=f[1]);var g=c.model.specifiedFileContent.match(/^.*$/gm);g&&(c.model.specifiedFileContent=g.slice(b-1,e).join("\n"))}}var h="?RESULT?",i=null,j=null,k=!1;c.RESULT_FILE_NAME=h,c.fileIndex=null,c.files=[],c.model={currentFilename:null,specifiedFileContent:null},c.editOnPlunker=function(){b(i.files,i.description,i.tags)},c.onHighlight=function(){k=!0,g(j),j.autogrow&&e(j.autogrow)},c.$watch("model.currentFilename",function(a){a==h&&j.autogrow&&f(function(){e(j.autogrow)})},!0),c.$watch("sourcePath",function(b){angular.isString(b)&&b&&("."===b.charAt(0)?b=b.substr(1):"/"!==b.charAt(0)&&(b="/"+b),"/"!==b.substr(-1)&&(b+="/"),c.resultPath=b,c.fileIndex={},c.model.currentFilename=null,c.files.length=0,a(b).then(function(a){angular.forEach(a.files,function(a,b){var d={name:b,content:a.content};c.files.push(d),c.fileIndex[b]=d}),c.model.currentFilename=c.files[0].name,i=a}))}),c.$watch("config",function(a){angular.isDefined(a)&&angular.isObject(a)&&(j=angular.copy(a),angular.forEach(j,function(a,b){switch(b){case"result":j[b]=c.$eval(a)}}),k&&g(j))},!0)}}}]);